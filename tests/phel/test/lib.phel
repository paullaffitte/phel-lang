(ns phel\test\lib)

(def stats @{
  :total 0
  :failed 0
  :successful 0
})

(defn assertStr [test testStr left right label]
  (do
    (update-in stats [:total] inc)
    (if (test left right)
      (do
        (update-in stats [:successful] inc)
        (print ".")
        (when (= (% (get stats :total) 80) 0)
          (println)))
      (do
        (update-in stats [:failed] inc)
        (print "\nError on \"")
        (print label)
        (print "\" - Expected: ")
        (print right testStr left)
        (php/print "\n")))))

(defmacro assert
  [test left right label]
  `(assertStr ,test ,(print-str test) ,left ,right ,label)
)

(defn print-summary []
  (do
    (print "\n\n")
    (println "Summary of: " __FILE__)
    (print "Successful: ")
    (print (get stats :successful))
    (print "\n")
    (print "Failed: ")
    (print (get stats :failed))
    (print "\n")
    (print "Total: ")
    (print (get stats :total))
    (print "\n")))
